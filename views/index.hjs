<!doctype html>
<html>
	<head>
		<title>Ben Bernstein</title>
		<meta charset="UTF-8">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <style type="text/css">
			body {width: 100%; text-align: center; margin: 0;}

			#BottomResults {
			    width: 100%; height: 300px;
			    position: absolute;
			    background-color: #E6E6E6;
			    bottom: 0;
			}
			#CourseList, #SectionList {
				width: 300px; height: 300px;
				background-color: white;
				float: left;
				border-right: 3px solid blue;
				overflow: scroll;}

			#CourseList li {cursor: pointer;}
        </style>
	</head>
    <body>
        <h1>{{ title }}</h1>
        <form>
			Search for courses: <input id="CSearch" type="text" name="courseSearch"><span id="LoadingInfo" style="opacity:0;">Loading...</span>
		</form>
        <div id="BottomResults">
        	<div id="CourseList"></div>
        	<div id="SectionList"></div>
        	<div id="InfoPanel"></div>
        </div>
    </body>
    <script type="text/javascript">
   	var delay = (function(){
	  var timer = 0;
	  return function(callback, ms){
	    clearTimeout (timer);
	    timer = setTimeout(callback, ms);
	  };
	})();

   	$('#CSearch').on('input',function(e){
		delay(function(){
		  	var searchTerms = $('#CSearch').val();

			console.log(searchTerms);
			try {
				if (searchTerms != "" && searchTerms != 'favicon.ico') {
					searchTerms = searchTerms.replace(' ', "/");
					searchTerms = searchTerms.replace('-', "/");
					$('#LoadingInfo').css('opacity', '1');
					$.get("/"+searchTerms)
					.done(function(data) {
						$('#CourseList').html(data);
						$('#LoadingInfo').css('opacity', '0');

						$('#CourseList li').click(function() {
							console.log('click');
							var courseName = $(this).html().replace(' ', "/");
							
							$.get("/"+courseName)
							.done(function(data) {
								$('#InfoPanel').html(data);
							});
						});
					});
				} else {
					$('#InfoPanel').html("No Results");
				}
			} 
			catch(err) {console.log('No Results');}
		}, 200);
	});
	
    </script>
</html>