function SendReq(a,b,c){LoadingSum+=1,LoadingIndicate(),$.get(a).done(function(a){"localStorage"==b?localStorage[c]=JSON.stringify(a):"sessionStorage"==b?sessionStorage[c]=JSON.stringify(a):b(a,c)}).always(function(){LoadingSum-=1,LoadingIndicate()})}function LoadingIndicate(){LoadingSum>0?$("#LoadingInfo").css("display","inline-block"):$("#LoadingInfo").css("display","none")}function ClickTriggers(){$("body").on("click","#CourseList li",function(){$("#SectionInfo").empty();var a=$(this).find(".courseNumber").html(),b=$("#searchSelect").val(),c="all";"instSearch"==b&&(c=$("#CSearch").val()),getSectionNumbers(a,c)}).on("click","#SectionList i:nth-child(1)",function(){console.log($(this).parent());var a=$(this).parent().attr("id"),b=$("#schedSelect").val();"fa fa-plus"==$(this).attr("class")?addToSched(a,b):"fa fa-times"==$(this).attr("class")&&removeFromSched(a,b)}).on("click","#SectionList span:nth-child(4)",function(){var a=$(this).html().split("-")[0].replace(/ /g,"");if(getSectionInfo(a),"Starred Sections"==$("#CourseTitle").html()){var b=a.slice(0,-6);getCourseNumbers(b,"courseIDSearch")}}).on("click","#SectionList i:nth-child(5)",function(){var a=$(this).attr("class");"fa fa-star-o"==a?addRem="add":"fa fa-star"==a&&(addRem="rem"),Stars(addRem,$(this).prev().html().split("-")[0].replace(/ /g,"")),$(this).toggleClass("fa-star"),$(this).toggleClass("fa-star-o"),"rem"==addRem&&"starredSec"==$(this).parent().attr("class")&&$(this).parent().remove()}).on("click",".DescBlock",function(){$("#SectionInfo p").toggle()}).on("click","#SectionInfo span:nth-child(1)",function(){var a=$(this).next().html().replace(/ /g,"-"),b=$("#schedSelect").val();addToSched(a,b)}).on("click",".AsscText span:nth-child(2)",function(){var a=$(this).html().replace(/ /g," ");getSectionInfo(a)}).on("click",".CloseX",function(a){var b=$("#schedSelect").val();removeFromSched($(this).parent().attr("id"),b),a.stopPropagation()}).on("mouseover",".SchedBlock",function(){$(this).find(".CloseX").css("opacity","1")}).on("mouseout",".SchedBlock",function(){$(this).find(".CloseX").css("opacity","0")}).on("click",".SchedBlock",function(){sec=$(this).attr("id");for(var a=7;a<sec.length;a++)if(parseFloat(sec[a])!=sec[a]){secname=sec.substr(0,a);break}var b=secname.slice(0,-3),c=secname.slice(0,-6);getCourseNumbers(c,"courseIDSearch"),getSectionNumbers(b,"all","suppress"),getSectionInfo(secname)})}function SchedTriggers(){$("li ul li","#MenuButtons").click(function(){var a,b;if("Download"==$(this).html()&&html2canvas($("#SchedGraph"),{onrendered:function(a){var b=new Image;b.src=a.toDataURL("image/png"),$("#SchedImage").attr("src",b.src).attr("title","My Schedule")}}),"New"==$(this).html()){for(a=prompt("Please enter a name for your new schedule.");-1!=JSON.parse(sessionStorage.schedList).indexOf(a);)a=prompt("Please enter a unique name for your new schedule.");""!==a&&null!==a&&(b="/Sched?addRem=name&courseID=blank&schedName="+a,SendReq(b,ListScheds,-2))}if("Duplicate"==$(this).html()&&(a=$("#schedSelect").val(),b="/Sched?addRem=dup&courseID=blank&schedName="+a,SendReq(b,ListScheds,-2),swal({title:"Schedule duplicated.",type:"success",timer:1e3})),"Rename"==$(this).html()){for(a=$("#schedSelect").val(),schedRename=prompt("Please enter a name for your new schedule.");-1!=JSON.parse(sessionStorage.schedList).indexOf(schedRename);)schedRename=prompt("Please enter a unique name for your new schedule.");""!==a&&null!==a&&(b="/Sched?addRem=ren&courseID=blank&schedName="+a+"&schedRename="+schedRename,SendReq(b,ListScheds,-2))}"Clear"==$(this).html()&&swal({title:"Are you sure you want to clear your whole schedule?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!1},function(){clearSched(),swal({title:"Your schedule has been cleared.",type:"success",timer:1e3})}),"Delete"==$(this).html()&&swal({title:"Are you sure you want to delete this schedule?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!1},function(){deleteSched(),swal({title:"Your schedule has been deleted.",type:"success",timer:1e3})}),"Recolor"==$(this).html()&&(colorPalette=JSON.parse(sessionStorage.colorPalette),newcolorPalette=shuffle(colorPalette),sessionStorage.colorPalette=JSON.stringify(colorPalette),SpitSched(JSON.parse(sessionStorage.currentSched)))})}function ListScheds(a,b){var c=$("#schedSelect");c.empty();for(var d in a)a.hasOwnProperty(d)&&c.append('<option value="'+a[d]+'">'+a[d]+"</option>");var e;e=0===b?a[0]:a[a.length-1],$("#schedSelect").find('option[value="'+e+'"]').attr("selected","selected"),sessionStorage.schedList=JSON.stringify(a);var f="/Sched?addRem=blank&courseID=blank&schedName="+e;SendReq(f,SpitSched,[])}function initiateSearch(){var a=$("#CSearch").val();try{if("favicon.ico"!=a&&"blank"!=a&&""!==a){var b,c,d,e=$("#searchSelect").val();if("keywordSearch"!=e&&"instSearch"!=e){var f=formatCourseID(a);b=f.split("/")[0],c=f.split("/")[1],d=f.split("/")[2],"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d="")}else b=a,c="",d="";getCourseNumbers(b,e),3==c.length?getSectionNumbers(b+c,"all",d.length):($("#SectionTitle").empty(),$("#CourseTitle").empty(),$("#SectionList > ul").empty()),3==d.length?getSectionInfo(b+c+d):$("#SectionInfo").empty()}else""!==a&&($("#CourseList").empty(),$("#CourseTitle").empty(),$("#SectionList > ul").empty(),$("#SectionInfo").empty())}catch(g){console.log("No Results "+g)}}function formatCourseID(a){return splitTerms=a.replace(/ /g,"").replace(/-/g,"").replace(/:/g,""),parseFloat(splitTerms[2])==splitTerms[2]?(splitTerms=splitTerms.substr(0,2)+"/"+splitTerms.substr(2),parseFloat(splitTerms[6])==splitTerms[6]&&(splitTerms=splitTerms.substr(0,6)+"/"+splitTerms.substr(6))):parseFloat(splitTerms[3])==splitTerms[3]?(splitTerms=splitTerms.substr(0,3)+"/"+splitTerms.substr(3),parseFloat(splitTerms[7])==splitTerms[7]&&(splitTerms=splitTerms.substr(0,7)+"/"+splitTerms.substr(7))):parseFloat(splitTerms[4])==splitTerms[4]&&(splitTerms=splitTerms.substr(0,4)+"/"+splitTerms.substr(4),parseFloat(splitTerms[8])==splitTerms[8]&&(splitTerms=splitTerms.substr(0,8)+"/"+splitTerms.substr(8))),splitTerms}function getCourseNumbers(a,b){var c="&reqParam="+$("#reqFilter").val(),d="&proParam="+$("#proFilter").val(),e="&actParam="+$("#actFilter").val();"&reqParam=noFilter"==c&&(c=""),"&proParam=noFilter"==d&&(d=""),"&actParam=noFilter"==e&&(e=""),sessionStorage.lastReq="getCourseNumbers",sessionStorage.lastPar=JSON.stringify([a,b]);var f="/Search?searchType="+b+"&resultType=deptSearch&searchParam="+a+c+d+e;SendReq(f,CourseFormat)}function CourseFormat(a,b){"string"==typeof a&&(a=JSON.parse(a));var c="";if($.isEmptyObject(a))c="&nbsp&nbsp&nbsp&nbsp&nbspNo Results";else{c="<ul>";for(var d in a)a.hasOwnProperty(d)&&(pcrFrac=0,c+='<li id="'+a[d].courseListName.replace(" ","-")+'"><span class="PCR tooltip" style="background-color:rgba(45, 160, 240, '+pcrFrac*pcrFrac+')">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="courseNumber">'+a[d].courseListName+'</span><span class="CourseTitle"> - '+a[d].courseTitle+"</span></li>");c+="</ul>"}$("#CourseList").html(c);for(var e in a){var f=a[e].courseListName;RetrievePCR(f)}$(".tooltip","#CourseList").tooltipster({position:"right"})}function getSectionNumbers(a,b,c){var d="&actParam="+$("#actFilter").val();"&actParam=noFilter"==d&&(d=""),$("#closedCheck").is(":checked")?searchOpen="":searchOpen="&openAllow=true",sessionStorage.lastReq="getSectionNumbers",sessionStorage.lastPar=JSON.stringify([a,b,c]),searchURL="/Search?searchType=courseIDSearch&resultType=numbSearch&searchParam="+a+"&instFilter="+b+d+searchOpen,SendReq(searchURL,FormatSectionsList,c)}function FormatSectionsList(a,b){if("string"==typeof a&&(a=JSON.parse(a)),"No Results"==a[1])$("#CourseTitle").html("No Results"),$("#SectionList > ul").empty();else{var c="",d=sessionStorage.starList,e=a[0];for(var f in e)if(e.hasOwnProperty(f)){var g="fa fa-star-o",h="plus",i=d.indexOf(e[f].NoSpace);i>-1&&(g="fa fa-star");var j=$.map(JSON.parse(sessionStorage.currentSched),function(a){return a.fullCourseName.replace(/ /g,"")});j.some(function(a){a.substring(0,e[f].SectionName.replace(/ /g,"").length)==e[f].SectionName.replace(/ /g,"")&&(h="times")}),c+='<li id="'+e[f].SectionName.replace(/ /g,"-")+'"><i class="fa fa-'+h+'"></i>&nbsp&nbsp<span class="'+e[f].StatusClass+'">&nbsp&nbsp&nbsp&nbsp&nbsp</span>&nbsp;&nbsp;<span class="PCR tooltip">&nbsp&nbsp&nbsp&nbsp&nbsp</span>&nbsp;&nbsp;<span>'+e[f].SectionName+e[f].TimeInfo+'</span><i class="'+g+'"></i></li>'}$("#CourseTitle").html(e[f].CourseTitle),$("#SectionList > ul").html(c);for(var k in e)RetrievePCR(e[k].SectionName,e[k].SectionInst.toUpperCase().replace(/ /g,"-").replace(/\./,"-"));$(".tooltip","#SectionList").tooltipster({position:"right"}),b||(a[1].FullID=a[1].CourseID,delete a[1].Instructor,delete a[1].OpenClose,delete a[1].TimeInfo,delete a[1].AssociatedSections,SectionInfoFormat(a[1]))}}function getSectionInfo(a){searchURL="/Search?searchType=courseIDSearch&resultType=sectSearch&searchParam="+a,SendReq(searchURL,SectionInfoFormat,[])}function SectionInfoFormat(a,b){if("string"==typeof a&&(a=JSON.parse(a)),"No Results"==a)$("#SectionInfo").html("No Results");else{var c="";a.FullID&&(c+="<span>"+a.FullID+"</span>"),a.Title&&(c+=" - "+a.Title+"<br><br>"),a.Instructor&&(c+="Instructor: "+a.Instructor+"<br><br>"),a.TimeInfo&&(c+=a.TimeInfo+"<br>"),a.Description&&(c+="Description:<br>"+a.Description+"<br>"),a.OpenClose&&(c+="Status: "+a.OpenClose+"<br><br>"),a.termsOffered&&(c+=a.termsOffered+"<br><br>"),a.Prerequisites&&(c+="Prerequisites: "+a.Prerequisites+"<br>"),a.AssociatedSections&&(c+=a.AssociatedSections),$("#SectionInfo").html(c)}}function Stars(a,b){sessionStorage.lastReq="Stars",sessionStorage.lastPar=JSON.stringify([a,b]);var c="/Star?addRem="+a+"&courseID="+b;SendReq(c,StarHandle,a)}function StarHandle(a,b){if("string"==typeof a&&(a=JSON.parse(a)),"show"!=b)return sessionStorage.starList=JSON.stringify(a),a;$("#SectionList > ul").empty();for(var c in a)if(a.hasOwnProperty(c)){var d="/Search?searchType=courseIDSearch&resultType=numbSearch&searchParam="+a[c]+"&instFilter=all";SendReq(d,StarFormat,[])}"undefined"==typeof c&&($("#SectionTitle").html("No starred sections"),$("#SectionList > ul").empty())}function StarFormat(a){"string"==typeof a&&(a=JSON.parse(a));var b="fa fa-star",c="";for(var d in a[0])if(a[0].hasOwnProperty(d)){var e="plus",f=$.map(JSON.parse(sessionStorage.currentSched),function(a){return a.fullCourseName.replace(/ /g,"")});f.some(function(b){b.substring(0,a[0].NoSpace)==d&&(e="times")}),c+='<li id="'+a[0][d].SectionName.replace(/ /g,"-")+'" class="starredSec"><i class="fa fa-'+e+'"></i>&nbsp&nbsp<span class="'+a[0][d].StatusClass+'">&nbsp&nbsp&nbsp&nbsp&nbsp</span>&nbsp;&nbsp;<span class="PCR tooltip">&nbsp&nbsp&nbsp&nbsp&nbsp</span>&nbsp;&nbsp;<span>'+a[0][d].SectionName+a[0][d].TimeInfo+'</span><i class="'+b+'"></i></li>'}$("#CourseTitle").html("Starred Sections"),$("#SectionList > ul").append(c);for(var g in a[0])RetrievePCR(a[0][g].SectionName);$(".tooltip","#SectionList").tooltipster({position:"right"})}function RetrievePCR(a,b){var c=a.split(" ")[0];if(localStorage["Review"+c])return ApplyPCR(a,b),"done";LoadingSum+=1,LoadingIndicate(),baseURL="/NewReview?dept="+c;try{$.ajax({url:baseURL,async:!1}).done(function(d){return localStorage["Review"+c]=d,ApplyPCR(a,b),"done"}).always(function(){LoadingSum-=1,LoadingIndicate()})}catch(d){console.log(d)}}function ApplyPCR(a,b){var c,d=a.split(" ")[0],e=d+" "+a.split(" ")[1],f=JSON.parse(localStorage["Review"+d]),g=f[e];if("undefined"==typeof g&&(c={}),"undefined"==typeof b)"undefined"!=typeof g&&(c=g.Total);else for(var h in g)if(h.indexOf(b.toUpperCase())>-1){c=g[h];break}var i=$("#"+a.replace(/ /g,"-")),j=i.find(".PCR");try{if(pcrFrac=c.cQ/4,isNaN(c.cQ))j.html("0.00");else{for(cQStr=c.cQ.toString(),1==cQStr.length&&(cQStr+=".");cQStr.length<4;)cQStr+="0";j.html(cQStr)}}catch(k){pcrFrac=0}j.css("background-color","rgba(45, 160, 240, "+5*Math.pow(pcrFrac,5)+")"),c&&j.prop("title","Diff: "+(c.cD||"0.00")+" Instructor: "+(c.cI||"0.00"))}function addToSched(a,b){var c=a.replace(/-/g,""),d="/Sched?addRem=add&schedName="+b+"&courseID="+c;SendReq(d,SpitSched,[]);try{$("#"+a+" i:nth-child(1)").toggleClass("fa-plus"),$("#"+a+" i:nth-child(1)").toggleClass("fa-times")}catch(e){}}function removeFromSched(a,b){for(var c=a.replace(/-/g,""),d="",e=7;e<c.length;e++)if(parseFloat(c[e])!=c[e]){d=c.substr(0,e);break}d.length||(d=c);var f="/Sched?addRem=rem&schedName="+b+"&courseID="+d;SendReq(f,SpitSched,[]);try{$("#"+a+" i:nth-child(1)").toggleClass("fa-plus"),$("#"+a+" i:nth-child(1)").toggleClass("fa-times")}catch(g){}}function clearSched(){var a=$("#schedSelect").val();schedURL="/Sched?addRem=clear&schedName="+a,SendReq(schedURL,SpitSched,[])}function deleteSched(){var a=$("#schedSelect").val();schedURL="/Sched?addRem=del&schedName="+a,SendReq(schedURL,ListScheds,0)}function SpitSched(a){var b=$("#Schedule"),c=$("#TimeCol"),d=["M","T","W","R","F"],e=["Monday","Tuesday","Wednesday","Thursday","Friday"],f=10,g=15,h=20;incSun=0,incSat=0;var i,j;for(i in a)if(a.hasOwnProperty(i)){var k=a[i].meetHour;f>=k&&(f=Math.floor(k)),k+a[i].HourLength>=g&&(g=Math.ceil(k+a[i].HourLength));for(j in a[i].meetDay){var l=a[i].meetDay[j];"U"==l&&(incSun=1),"S"==l&&(incSat=1)}}1==incSun&&(d.unshift("U"),e.unshift("Sunday")),1==incSat&&(d.push("S"),e.push("Saturday")),h=100/(5+incSun+incSat);var m=95/(g-f+1),n="",o="";if($.isEmptyObject(a))b.html("<span>Click a section's + icon to add it to the schedule</span>"),c.empty();else{for(var p=0;g-f>=p;p++)toppos=p*m+7.5,hourtext=Math.round(p+f),hourtext>12&&(hourtext-=12),o+='<div class="TimeBlock" style="top:'+toppos+'%">'+hourtext+":00</div>",n+='<hr width="100%"style="top:'+toppos+'%" >';for(var q in d)n+='<div class="DayName" style="width:'+h+'%;">'+e[q]+"</div>";b.html(n),c.html(o)}var r={},s=0,t=JSON.parse(sessionStorage.colorPalette);for(i in a)a.hasOwnProperty(i)&&(r[a[i].fullCourseName]=t[s],s+=1);for(i in a)if(a.hasOwnProperty(i))for(j in a[i].meetDay)if(a[i].meetDay.hasOwnProperty(j)){var u,v=a[i].meetDay[j];for(var w in d)if(d[w]==v){u=w*h;break}var x=(a[i].meetHour-f)*m+9,y=a[i].HourLength*m,z=a[i].fullCourseName,A=a[i].meetRoom,B=r[a[i].fullCourseName];"undefined"==typeof B&&(B="#E6E6E6");var C=(a[i].fullCourseName.replace(/ /g,"")+d[w]+a[i].meetHour).replace(".","");b.append('<div class="SchedBlock '+i+" "+d[w]+'" id="'+C+'" style="top:'+x+"%;left:"+u+"%;width:"+h+"%;height:"+y+"%;background-color:"+B+'"><div class="CloseX">x</div>'+z+"<br>"+A+"</div>"),$(".SchedBlock").each(function(c){var e=$(this).attr("class").split(" ")[1],f=$(this).attr("class").split(" ")[2];if(e!=i&&f==d[w]&&twoOverlap(a[e],a[i])){var g=100*$(this).outerWidth()/$("#Schedule").outerWidth();$(this).css("width",g/2+"%");var h,j=$("#"+C),k=100*(j.offset().left-b.offset().left)/b.outerWidth();h=$(this).offset().left==j.offset().left?g/2:0,j.css("left",k+h+"%").css("width",g/2+"%")}})}sessionStorage.currentSched=JSON.stringify(a)}function twoOverlap(a,b){var c=a.meetHour,d=a.HourLength,e=c+d,f=b.meetHour,g=b.HourLength,h=f+g;return f>=e||c>=h?!1:!0}function detectIE(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),c=a.indexOf("Trident/");return b>0||c>0?!0:!1}$(document).ready(function(){detectIE()&&$("#LoadingInfo").html("Loading ...");var a=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}();shuffle=function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},LoadingSum=0;var b;sessionStorage.colorPalette?b=JSON.parse(sessionStorage.colorPalette):(b=["#1abc9c","#e74c3c","#f1c40f","#3498db","#9b59b6","#e67e22","#2ecc71","#95a5a6","#FF73FD","#73F1FF","#CA75FF","#ecf0f1"],sessionStorage.colorPalette=JSON.stringify(b));var c="/Sched?addRem=name&courseID=blank";SendReq(c,ListScheds,0);var d="/Star?addRem=show&courseID=show";SendReq(d,"sessionStorage","starList"),ClickTriggers(),SchedTriggers(),$("#schedSelect").change(function(){var a=$("#schedSelect").val(),b="/Sched?addRem=blank&courseID=blank&schedName="+a;SendReq(b,SpitSched,[])}),$("#reqFilter, #proFilter, #openCheck, #closedCheck, #actFilter").change(function(){window[sessionStorage.lastReq].apply(this,JSON.parse(sessionStorage.lastPar))}),$("#searchSelect").change(function(){var a=$("#CSearch").val();""!==a&&initiateSearch()}),$("#CSearch").on("input",function(){a(function(){initiateSearch()},500)}),$("a[rel*=leanModal]").leanModal({top:70,closeButton:".modal_close"})});